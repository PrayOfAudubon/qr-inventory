# QRコード在庫管理システム

## 概要

QRコード在庫管理システムは、QRコードを使用して物品の入出庫を簡単に管理できるウェブアプリケーションです。スマートフォンやタブレットのカメラを使用してQRコードをスキャンし、在庫の確認や更新を行うことができます。

## 主な機能

- QRコードのスキャン（カメラ利用またはファイル選択）
- 品目情報の表示（品目名、在庫数）
- 入庫/出庫処理の記録
- 用途別在庫管理（外来用/訪問用）
- スタッフ名による記録

## 使い方

### 1. 基本操作

1. アプリを開くと、「カメラを起動」ボタンが表示されます
2. ボタンをタップしてカメラを起動します
3. 品目のQRコードにカメラを向けてスキャンします
4. 品目情報が表示され、入出庫の操作が可能になります

### 2. 入出庫処理

スキャン後に表示される品目情報画面で以下の操作を行います：

1. 用途を選択：「外来用」または「訪問用」ボタンをタップ
2. スタッフ名をドロップダウンから選択
3. 数量を入力
4. 「入庫」または「出庫」ボタンをタップ
5. 確認ダイアログで「OK」をタップして処理を実行

### 3. 在庫確認

用途を選択すると、その用途に対応する現在の在庫数が表示されます。在庫数が0の場合は赤字で点滅表示されます。

### 4. カメラ画面に戻る

操作完了後、「カメラ画面へ戻る」ボタンをタップすると、QRコード読み取り画面に戻ります。

## 動作環境

本システムは以下の環境で動作確認済みです：

- iOS (Safari)
- iPadOS (Safari)
- Android (Chrome)
- Windows/Mac (Chrome, Edge, Safari)

## 技術情報

### 使用技術

- フロントエンド: HTML, CSS, JavaScript
- QRコード読み取り: ZXing ライブラリ
- バックエンド: Google Apps Script
- データベース: Google Spreadsheet

### システム構成

1. **フロントエンド（index.html）**
   - ユーザーインターフェース
   - QRコード読み取り機能
   - データ送受信処理

2. **バックエンド（Google Apps Script）**
   - データベースとの連携
   - 在庫処理ロジック
   - 入出庫ログの記録

3. **データベース（Google Spreadsheet）**
   - 品目マスターデータ
   - 在庫データ
   - 入出庫ログ

## トラブルシューティング

### カメラが起動しない場合

- ブラウザのカメラ権限が許可されているか確認してください
- 他のアプリがカメラを使用していないか確認してください
- ページを再読み込みしてください

### QRコードが読み取れない場合

- QRコードにカメラをしっかり向けて、適切な距離を保ってください
- 明るい環境で撮影してください
- QRコードが破損していないか確認してください
- 「カメラ画面へ戻る」ボタンで一度画面をリセットしてみてください

### 通信エラーが表示される場合

- インターネット接続を確認してください
- しばらく待ってから再試行してください
- アプリを再読み込みしてください

## セキュリティ

- データの通信はJSONPを利用して行われます
- システムへのアクセスには適切な権限が必要です
- 処理記録には操作者（スタッフ名）が記録されます

## 開発者向け情報

### コードの説明

- **codeReader**: ZXingライブラリを使用したQRコード読み取り機能の実装
- **callApi**: バックエンドと通信するためのJSONP関数
- **UI操作**: イベントリスナーを使用した各種操作の制御
- **状態管理**: グローバル変数による状態管理と処理中フラグの適切な管理

### カスタマイズ方法

1. **スタッフリストの変更**:
   - HTML内の`select`要素を編集し、オプションを追加/変更してください

2. **APIエンドポイントの変更**:
   - `API_BASE_URL`の値を修正してください

3. **UIのカスタマイズ**:
   - CSSを編集して見た目を変更できます
   - ボタン色やフォントサイズなどを調整できます
